# TODO high priority
- [ ] Re-write repopulateFormWithPreviousPayload to get desired results
- [ ] Re-activate addCollectionToDatabase after you're done messing around with it
- [ ] collection form allows you to add categories with items attached to each category
- [ ] write tests for collection form
- [ ] write "what kind of information about the videos do you want to collect from your users?" form
  - [] Meta-form? May have to attach an input box(es) to a dropdown menu with types (e.g., datepicker, input, etc. etc.) to populate form; maybe display the form that the user is creating in real time??
- [ ] The new match and create account forms are refactored to use dynamic forms
- [ ] People can earn the privilege to be able to comment on moves or matches
- [ ] Users can create collections
  - [ ] Form
    - [ ] They can name their collection
    - [ ] They can designate any number of collection-details that they want their videos to have
    - [ ] Tests written to ensure you have to be logged in to see collection form
    - [ ] Tests written to make sure form cannot be submitted without collection name and at least one category
  - [ ] Their videos are displayed in a table
- [ ] Write tests for isAnnotated status changing if so many users vote high enough
  - [ ] Too few votes and not isAnnotated
  - [ ] Enough and isAnnotated is true
  - [ ] Once isAnnotated is true, reputation awarded to majority annotator
  - [ ] Doesn't continue to award if there are more upvotes (i.e., if isAnnotated has already been marked true)
- [ ] Set up a dev project in firebase and hook up there instead
- [ ] Write tests for stripe subscription and cancellation

- [ ] Users can create their own collections of annotated videos
   - [ ] Can customize the name of the individuals (e.g., "athlete, animal, instructor")
   - [ ] Can customize the number of individuals (e.g., pod of dolphins)
   - [ ] Can download a csv of their data table
   - [ ] Can customize the details of the video (location, date, etc.)? Seems very difficult
- [ ] They can share and collaborate on collections if they pay subscription
   - [ ] Admin can bypass subscription share for particular collections

- [ ] Store local preferences for items per page in all-matches
- [ ] Some annotation manipulations affect video play for another person's instance (test using aws version and localhost version?)
  - [ ] Characterize the problem better
- [ ] Display flagged moves in admin after they have been flagged X times (define in constants.ts)
- [ ] Stripe follow-up
  - [ ] Zip code validation
  - [ ] Webhook
  - [ ] Let user know that bill will appear as Fisher Dynamic
- [ ] //TODO this is the only part that is not in base component...experiment with putting it in there
- [ ] Add interesting exchange or something like that
- [ ] If someone removes a flag from an annotation, and that changes the reputation scoring, reward them those points back
- [ ] Add a minimum number of flags before it modifies the annotation chip to constants.ts and then to the key
- [ ] Maybe make a go to end icon on the chips for individual annotations?
- [ ] Once you have internet
  - [ ] Update faq component link to different divs in the FAQ
    - [ ] TODO link to how to lose them
  - [ ] //TODO flesh out getMainAnnotatorOfMatch
- [ ] Improve moveCategory capture with a getCategoryFromItem method... it should use moves.ts, I think
- [ ] Add way to handle when someone is not connected
- [ ] Track who flags things
- [ ] What happens when a user tries to rate their own annotation currently?
- [ ] Test the new root node works (by annotating multiple times deep in the tree)
- [ ] Test isWin and isDraw?
- [ ] Test for annotation flag on and off
- [ ] Test for five annotation flags

- [ ] Finish writing the double annotation test
  - [ ] Get rid of subscription errors so that tests can pass
- [ ] Troubleshoot/edit the currently existing tests
- [ ] Snackbars for annotation and for annotation already exists need to come up at the relevant times


- [ ] Set up tutorial mode
- [ ] Make new user-status report behave in the ways it's supposed to since its move to a menu

- [ ] Add component for adding names to matches with people with unknown names
- [ ] If they are majority annotator, they cannot rate the annotation
  - [x] get everything to work except getMainAnnotatorOfMatch
  - [ ] //TODO flesh out getMainAnnotatorOfMatch
- [ ] //TODO accommodate vimeo, etc?
- [ ] Tracks who deletes matches and annotations in user node
- [ ] Iron out paidStatus vs. things like canViewAllMatches and somehow manage them easily
  - [ ] Paying attention to the annotatedEnoughOverride and how this is affected
- [ ] Think about and possibly implement users submitting videos that don't appear in the main table but still get used for analytics
- [ ] Edit any annotation they themselves made
- [ ] Update the check for annotation merge
- [ ] Edit user details page
- [ ] Update reputation should include an update to privileges and an onChange snackbar to alert user of new privileges
- [ ] User page; badge with reputation points
- [ ] F.A.Q. section
    - [ ] Document how to annotate a win or draw somewhere (i.e., specify that it should be worth no points, not be called a submission, and should be marked successful even if draw)
    - [ ] Why did I lose reputation points?
    - [ ] What do various tiers of reputations points get me?
      - [ ] Add new move names
      - [ ] Audit names of moves proposed (TODO check how wikipedia deals with profanity edits, etc.)
      - [ ] Rate annotations (x per day increases as reputation increases)
      - [ ] Flag annotations for removal
      - [ ] Remove annotations
      - [ ] Search by different criteria? (also available to paying user)
      - [ ] Edit move details
    - [ ] How do I earn reputation?
      - [ ] Submitting matches
      - [ ] Approving new move names
      - [ ] Flagging new move names as vulgar or inappropriate
      - [ ] Annotating matches
        - [ ] You get more points for well-rated annotations
      - [ ] Rating matches?
- [ ] Update spec list
- [ ] TODO make the signs up a new user test pass (currently does not)
- [ ] Need a way to handle things like missing uid in users
- [ ] Submission status and success status in the form stays imprinted on the previously annotated move
- [ ] cannot make the same exact annotation twice test
- [ ] Tests to tell whether someone with paidStatus true can see matches but not delete, someone who has not paid cannot see matches
- [ ] Write a test to annotate two moves in a row, both with a move deep in the tree
- [ ] info for ratings (1 annotation hasn't been rated or is annotated mostly incorrectly, 4 is annotated everything that the ref scores, 5 is annotated beyond that with more details)
- [ ] Figure out why creating a new user works fine manually but not with the cypress test in login.spec
- [ ] Add some way of preventing users from simply making one shitty annotation and getting in
  - [ ] Add some way of disabling them for a punishingly long time if they do it
- [ ] Add branching/if statements to cypress login as admin test
- [ ] Either have a question on the form about whether the match uses points or somehow automate that to prevent users from assigning points in tournament types that don't reward them
- [ ] getMainAnnotatorOfMatch doesn't work as expected yet
- [ ] reset annotationVotesCastToday at midnight every night
- [ ] Add a paid status guard to all matches and stats (when there are stats)
- [ ] Add onDestroy handling for the memory leakers?
- [ ] When you rate an annotation with a four and it's not your own, it awards the majority annotator x reputation points TODO hackable (do you unreward if diluted by crap?)
  - [ ] TODO && current rater is not the main annotator
- [ ] When you rate an annotation with a four and it's not your own, it awards the majority annotator x reputation points TODO hackable? (do you unreward if diluted by crap?)
- [ ] Monitor user's reputation points and enable privileges when things change
- [ ] Dialog for adding move names (if certain privileges; else, notify not enough privileges)
- [ ] Admin and moderators have a special area only they can access and do administrative things in
- [ ] Separate and gitignore the admin email and password and then go back through and erase
- [ ] Detect when the link url is different but other match specs are the same
- [ ] Tests
  - [ ] Improve deleting a match test
  - [ ] Flesh out 'created match appears on table' test
- [ ] Reset attemptStatus to true after every finished annotation
- [ ] Figure out a way to remove the api key and admin email and password from the repo (in an automated way)
- [ ] Set up CircleCI deploy to S3
- [ ] Test logging out from individual match
- [ ] Test rating the match and annotation (possibly as two different users)
- [ ] Add date annotated to move in match
- [ ] Make the match card display more info. (including date)
- [ ] //@TODO test whether trying to create a second account under the same email messes up
- [ ] //TODO I couldn't get the takeWhile to work, so hacked with a counter

# TODO low priority
- [ ] Add spinner while annotation deletion occurs (nvm it's for admins and therefore low priority)
- [ ] Whether the user has verified their email address or not doesn't matter yet
- [ ] Put number of stars and star votes that result in various reputation rewards in constant.ts
- [ ] //TODO && submissionStatusValue stuff && attemptStatusValue stuff
- [ ] Flesh out README with details about what it is and how it works
- [ ] Add more passes to moves.ts

# Completed TODOs
- [x] Custom categories
  - [x] weight class
    - [x] Dropdown
    - [x] Dialogue
    - [x] Dialogue adds approval display for admin
    - [x] Form validation in dialog
    - [x] Doesn't add it and sends a little snackbar saying move name already exists if so
    - [x] Approval adds to db and removes from candidate list, and awards reputation points
    - [x] Disapproval removes from candidate list and substitutes, "flag me"
    - [x] Feature to delete move name from move list
    - [x] Renames move in the other matches that used it since? ...NOPE not needed, I don't think
    - [x] Put delete feature under control of isAdmin (or isModerator?)
    - [x] Standardize how these things are capitalized
    - [x] Test written to make sure name addition is seen in match
    - [x] Test written to make sure name approval is seen in admin list; delete name at the end
    - [x] Test written to make sure name disapproval displays flagged message
    - [x] Test written to make sure you can't add a duplicate name
  - [x] tournament
    - [x] Dropdown
    - [x] Dialogue
    - [x] Dialogue adds approval display for admin
    - [x] Form validation in dialog
    - [x] Doesn't add it and sends a little snackbar saying move name already exists if so
    - [x] Approval adds to db and removes from candidate list, and awards reputation points
    - [x] Disapproval removes from candidate list and substitutes, "flag me"
    - [x] Feature to delete move name from move list
    - [x] Put delete feature under control of isAdmin (or isModerator?)
    - [x] Added in alphabetical order
    - [x] Standardize how these things are capitalized
    - [x] Test written to make sure name addition is seen in match
    - [x] Test written to make sure name approval is seen in admin list; delete name at the end
    - [x] Test written to make sure name disapproval displays flagged message
    - [x] Test written to make sure you can't add a duplicate name
  - [x] age class
    - [x] Dropdown
    - [x] Dialogue
    - [x] Dialogue adds approval display for admin
    - [x] Form validation in dialog
    - [x] Doesn't add it and sends a little snackbar saying move name already exists if so
    - [x] Approval adds to db and removes from candidate list, and awards reputation points
    - [x] Disapproval removes from candidate list and substitutes, "flag me"
    - [x] Feature to delete move name from move list
    - [x] Put delete feature under control of isAdmin (or isModerator?)
    - [x] Added in alphabetical order
    - [x] Standardize how these things are capitalized
    - [x] Test written to make sure name addition is seen in match
    - [x] Test written to make sure name approval is seen in admin list; delete name at the end
    - [x] Test written to make sure name disapproval displays flagged message
    - [x] Test written to make sure you can't add a duplicate name
- [x] Have custom no gi rank option, and add unknown to it
    - [x] Passing tests
- [x] Have custom age class, and add unknown to it
    - [x] Passing tests
- [x] Have custom location option, and add unknown to it
    - [x] Passing tests
- [x] Have custom tournament option, and add unknown to it
    - [x] Passing tests
- [x] Add new move options to every section
- [x] Have custom weight class options, and add unknown to it
- [x] ADDING FEATURE WHERE DISAPPROVED NAME GETS SUBSTITUTED and check whether the same exists for tournament name cross listed in spec file
- [x] Enter upon password completion for login should trigger login button
- [x] See what happens when you try to add new submission name
- [x] Set up stripe
  - [x] Subscriptions
  - [x] Cancellation
  - [x] All of this in user section
- [x] Color-code match start and end chips
- [x] Track reasons for reputation awards and deductions (date, note/flag, points)
- [x] Sort moves in dialog dropdown menu
- [x] Sort weight classes other new match categories
- [x] Track reasons for reputation awards and deductions (date, note/flag, points)
- [x] Add moves
  - [x] Dropdown
  - [x] Dialogue
  - [x] Dialogue adds approval display for admin
  - [x] Form validation in dialog
  - [x] Form select is dynamic for subcategory
  - [x] Doesn't add it and sends a little snackbar saying move name already exists if so
  - [x] Approval adds to db and removes from candidate list, and awards reputation points
  - [x] Disapproval removes from candidate list and substitutes, "flag me"
  - [x] Feature to delete move name from move list
  - [x] Renames move in the other matches that used it since? ...NOPE not needed, I don't think
  - [x] Put delete feature under control of isAdmin (or isModerator?)
  - [x] Added moveNames not in alphabetical order
  - [x] Standardize how these things are capitalized
  - [x] Test written to make sure name addition is seen in match
  - [x] Test written to make sure name approval is seen in admin list; delete name at the end
  - [x] Test written to make sure name disapproval displays flagged message
  - [x] Test written to make sure you can't add a duplicate name
- [x] Change match outcome to match logistics and add match start as well as point mistake
- [x] Move the info. icon next to Annotations because you keep accidentally scrolling over it (or just make it clickable instead)
- [x] Alphabetize the moves in annotation lists
- [x] Change athlete names to dropdown menu with option to add more in a dialogue
  - [x] Dropdown
  - [x] Dialogue
  - [x] Dialogue adds approval display for admin
  - [x] Form validation in dialog
  - [x] Doesn't add it and sends a little snackbar saying athlete already exists if so
  - [x] Approval adds to db and removes from candidate list
  - [x] Disapproval removes from candidate list and substitutes, "Unnamed Athlete"
  - [x] Feature to delete athlete name from athlete list (but leaves them as legacy in existing matches [otherwise, have to track?])
  - [x] Put delete feature under control of isAdmin (or isModerator?)
  - [x] Added names not in alphabetical order (caps issue? Yes... make it so that Capital letters for first and last name is forced)
  - [x] Displays the name in the field after it is typed (sort of)
  - [x] Test written to make sure name addition is seen in table
  - [x] Test written to make sure name addition is seen in admin list; delete name at the end
- [x] 3 sec. rewind and ff buttons
- [x] Get current tests to pass
- [x] Add non-binary gender options
- [x] Track categories as well as move names (//TODO get category from item)
- [x] add matchUrl form validation that seems to look good but button enabling and disabling as well as database functionality need to be confirmed
- [x] Bring annotations closer to video
- [x] extend baseComponent in other components
- [x] Add confirm password field
- [x] Make password toggleable to be visible
- [x] Improve form validation for create account form
- [x] Make it so that annotations appear in match chronological order not addition chronological order
- [x] Update the check for annotation similarity
- [x] Add way to prevent ppl from seeing matches if they haven't earned it yet
- [x] Make chips deletable if isAdmin is true (or if certain reputation points exist)
- [x] Make annotations clickable to take user to that part of the video
- [x] Crudely visualize all annotations
- [x] Maybe put a delay between the user creation and the user login to avoid the alert popup
- [x] When you submit a match, it asks you if you want to annotate, and if you click annotate, it doesn't take you anywhere
- [x] Update the weight classes and belts of the matches that have already been made
- [x] Fix bugs with logging out (sometimes you have to do it multiply)
- [x] Get login to display and to successfully navigate both for login and for logout
- [x] Set up new email login dialog box
- [x] Add match annotations to user upon successful annotation; use this to resolve bug of most recent annotation
- [x] Annotation includes the annotator's user id
- [x] Have table auto-update when move details are revised
- [x] Add cannot create duplicate match test
- [x] Indicate to the user that a match was created
- [x] Check for and prevent duplicate videos from being added
- [x] Have logout reload the page and/or resetAll from the tracker
- [x] Set up admin email and password on circleCI
- [x] Test adding a new match
- [x] Delete a match only as an admin
- [x] Add was this a successful attempt functionality
- [x] Record ratings in user
- [x] Creating a new match isn't working??
- [x] Test clicking deeper into the tree
- [x] Add test for starting and stopping an annotation
- [x] Add test for cancelling annotation (making sure certain buttons are and are not visible)
- [x] Add guard jump
- [x] Add advantages to moves list
- [x] Add move to the user who made it, and include a timestamp in the entry as well
- [x] //TODO make record of video here
- [x] Fix test for clicking pause

# Tabled specs and TODOs
- [x] Remove match and annotation rating from matchDeets because they live elsewhere now

# Specs
- [ ] An annotation is not made if a similar enough one has already been made by someone else
- [ ] Admin status is tracked and admin can remove matches
- [ ] User can filter annotations by ones that scored points
- [ ] There's a way for a user to undo the most recent annotation they made?
- [ ] Users can look back 5 seconds or forward 5 seconds in a match
- [ ] Users see the advice to annotate what the ref awards points to if the match was reffed (can included other positions/moves that didn't score points, but can't disagree with ref)
- [ ] Users can submit feedback about the site (which automatically captures which page the feedback was sent from?)
- [ ] Set up unit testing, especially for database stuff
- [ ] Users can view embedded videos that are annotated with moves
- [ ] Users can sort videos to view by any combination of:
  - [ ] Belt/rank
  - [ ] Tournament
  - [ ] Date (y, m ,d)
  - [ ] Athlete name
  - [ ] Second athlete name
  - [ ] Rule set
  - [ ] Move executed in the match
  - [ ] Rating from other users
  - [ ] Annotation Rating
- [ ] Users can view summary statistics by athlete:
  - [ ] Most common points scored
  - [ ] Most common points lost
  - [ ] Most effective submission
  - [ ] Most frequent thing they tap to
  - [ ] Users can view summary statistics by rank:
    - [ ] Most common points scored
    - [ ] Most common points lost
    - [ ] Most effective submission
- [ ] Users are required to annotate a video each month or pay $2/month or $6/6 months or $10/yr.
  - [ ] A video is provided for them
  - [ ] The first time they annotate, a tutorial is provided
  - [ ] A refresher tutorial is available
  - [ ] For every annotated video, the user is given more experience Points
  - [ ] For every time a users' annotated video is flagged as poorly-annotated or edited and then the edit is confirmed, they lose some experience points
      - [ ] Which annotations were done by which user is known to the database, but not to other users (to avoid personal vendettas)
  - [ ] while a user is annotating a video, that video is "locked" for annotation by other users?
  - [ ] alternatively, there is some way of dealing with two users simultaneously annotating the same video
  - [ ] Whether the user manually skips ahead in the video is tracked with the timestamp, is flagged for their annotation, and/or is not permitted in the app.
- [ ] Experience points are visible by other users
- [ ] Users are granted more responsibility and more data access if they:
  - [ ] Rate videos
  - [ ] Vet other users' new/alternative names of moves
  - [ ] Confirm dead links
- [ ] While viewing a video, users can:
  - [ ] Flag a link as dead
    - [ ] In which case, it immediately goes into a "is this link dead" pool
  - [ ] Flag a poorly-annotated video
  - [ ] Edit details of the video
    - [ ] In which case, it immediately goes into a "to be reviewed" pool
- [ ] Users can annotate a video by:
  - [x] User clicks "annotate" while the video is in play
    - [ ] If a move exists in that time point, that move is displayed to user. User is given option to:
      - [ ] Edit the existing move
        - [ ] The old move is replaced, but stored in the db but flagged as old
        - [ ] Immediately goes into a queue to be confirmed by others
      - [ ] Flag it for removal
      - [ ] Add a new move overlapping the original
        - [ ] Beginning time
        - [ ] End time
        - [ ] Points scored (if any)
        - [ ] Name of the performer of the move (which athlete did it)
        - [ ] Whether it was a submission
        - [ ] The name of the move
        - [ ] Users can create a new move name if it doesn't exist
          - [ ] This name must be vetted by other users

# Completed Specs

- [x] Users can log in
- [x] Users can create an account
  - [x] Name
  - [x] Email
  - [x] Rank (gi)
  - [x] Rank (no gi)
  - [x] Affiliation
  - [x] Age
  - [x] Gender
  - [x] Date last annotated (defaults to null)
  - [x] paidStatus
  - [x] Weight (find a way for the input to be in kilos or lbs.)
  - [x] Reputation points (defaults to 100)

- [x] Users can add a brand new video with match details:
  - [x] Tournament name
  - [x] Location
  - [x] Date
  - [x] Athlete 1 name
  - [x] Athlete 2 name
  - [x] Weight class
  - [x] Gender
  - [x] Age class
  - [x] Gi status
  - [x] Rank
  - [x] Video url
    - [ ] Gets validated?


A *match* is composed of *match details* and *moves*.

# Low priority specs
- [ ] Migrate to firestore?
